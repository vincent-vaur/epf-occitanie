jQuery(function($) {

	$(window).on('load', function(){
		
		$(document).ready(function () {
			
			/* MAPS */
			if( typeof L !== 'undefined' && $('#carteInteractive').length > 0 ) {

        const map = L.map("carteInteractive", {
          maxZoom: 12,
          attributionControl: false,
          // zoomControl: false,
          boxZoom: false,
          // dragging: false,
          keyboard: false,
          // scrollWheelZoom: false,
        });
    
        // Calque des contours des régions
        const regionsLayer = L.geoJSON(regions).addTo(map);
    
        // Calque des préfectures
        L.geoJSON(cities, {
          onEachFeature: function (feature, layer) {
            L.marker(layer.getBounds().getCenter(), {
              icon: L.divIcon({
                className: 'city-container',
                html: '<div class="carret"></div><div class="label">' + feature.properties.nom_commun + '</div>'
              })
            }).addTo(map);
          }
        });
    
        // Ajout des sites
        $("#results article").each( function( i, el ) {
          var latLng = new L.LatLng( $(el).data('lat'), $(el).data('lng'));
          
          L.marker(latLng, {
            title: $(el).find('.titre').html(),
            icon: L.divIcon({
              className: 'city-marker-container',
              html: '<div class="city-marker"></div>'
            })
          })
          .bindPopup($(el).html())
          .addTo(map);
				});
    
        L.tileLayer("", {
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
          bounds: regionsLayer.getBounds()
        }).addTo(map);
    
        map.fitBounds(regionsLayer.getBounds());
        map.setMaxBounds(regionsLayer.getBounds());
        map.setMinZoom(map.getZoom());
				
				// var map = L.map('carteInteractive').setView([43.6487851,2.3435684], 8);
				// map.zoomControl.setPosition('bottomright');

				// var mapLayer = L.tileLayer(
				// 	'https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png', {
				// 	attribution: '<a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>',
				// 	minZoom: 1,
				// 	maxZoom: 19
				// });

				// map.addLayer(mapLayer);
				
				// var contour = {"type":"Polygon","coordinates":[[[5.6289579,45.046725199999997],[5.6289593,45.046853200000001],[5.6288406,45.047228400000002],[5.6290151,45.047223500000001],[5.6292086,45.0471395],[5.6299019,45.046723200000002],[5.6302327,45.0463874],[5.6307966,45.046259900000003],[5.6312582,45.046073200000002],[5.6315419,45.046040400000003],[5.632461,45.046010199999998],[5.632872,45.046064600000001],[5.6334593,45.0462463],[5.6340019,45.0465655],[5.6344218,45.046673400000003],[5.634942,45.046906499999999],[5.6357613,45.047069200000003],[5.6362275,45.047068299999999],[5.6364775,45.047160400000003],[5.6369169,45.046995000000003],[5.6380308,45.046802200000002],[5.6387363,45.049089700000003],[5.6394402,45.050507500000002],[5.6396586,45.050864900000001],[5.6407267,45.052522199999999],[5.6409932,45.052405],[5.6419127,45.053009400000001],[5.6422947,45.0530355],[5.6429137,45.054017399999999],[5.6441552,45.054333800000002],[5.6444384,45.053669900000003],[5.6455218,45.053303200000002],[5.6464343,45.053737300000002],[5.6468031,45.053398899999998],[5.6472452,45.053433900000002],[5.6486098,45.0537493],[5.6491195,45.0540521],[5.6493707,45.054140099999998],[5.6505602,45.054656199999997],[5.6510818,45.055037900000002],[5.6515928,45.055036600000001],[5.652048,45.055168999999999],[5.6525528,45.055847399999998],[5.6529216,45.056558699999997],[5.6530469,45.056991400000001],[5.6532423,45.057147200000003],[5.6536348,45.057619899999999],[5.6541189,45.058129600000001],[5.6545853,45.0581295],[5.6548897,45.058496300000002],[5.654998,45.058716599999997],[5.655522,45.058705799999998],[5.6565034,45.059975999999999],[5.6565746,45.060068299999998],[5.6567394,45.060151599999998],[5.6569048,45.060541200000003],[5.657528,45.061044600000002],[5.6577305,45.061329899999997],[5.6582573,45.061817400000002],[5.6585676,45.062065799999999],[5.6587316,45.062262500000003],[5.6587508,45.062348299999996],[5.6592547,45.063186799999997],[5.6594824,45.063495000000003],[5.6597097,45.063586700000002],[5.6598544,45.063863499999997],[5.6602477,45.064102699999999],[5.66069,45.064656900000003],[5.6618296,45.065671799999997],[5.6620017,45.065925800000002],[5.6620564,45.066382900000001],[5.6620238,45.066439699999997],[5.6629823,45.068003300000001],[5.6636642,45.068347299999999],[5.6639596,45.068947100000003],[5.6650529,45.069877599999998],[5.665189,45.069836700000003],[5.6683223,45.068869200000002],[5.6694952,45.0682203],[5.6696588,45.068094500000001],[5.6696563,45.067802100000002],[5.6699755,45.067409599999998],[5.6702271,45.0670796],[5.6702966,45.0665531],[5.6706848,45.066370499999998],[5.6713421,45.065917900000002],[5.6719774,45.065576800000002],[5.6742526,45.067912900000003],[5.6761143,45.069714699999999],[5.6809796,45.070056700000002],[5.6810385,45.070268800000001],[5.6811245,45.070917399999999],[5.6811073,45.071717599999999],[5.6810383,45.072053400000001],[5.6812954,45.072188199999999],[5.6813928,45.072397299999999],[5.6813817,45.0727002],[5.6813228,45.072913700000001],[5.6815267,45.073987199999998],[5.681559,45.074551100000001],[5.6821562,45.074929599999997],[5.6822605,45.075555999999999],[5.6828024,45.076266599999997],[5.682855,45.0765879],[5.6832617,45.077554499999998],[5.6869272,45.076615199999999],[5.6872845,45.0765119],[5.6874931,45.076390799999999],[5.6879394,45.075930200000002],[5.6894501,45.075330100000002],[5.6902371,45.075041900000002],[5.6907646,45.075496299999998],[5.6911138,45.075825199999997],[5.6912992,45.076078099999997],[5.6916702,45.076390099999998],[5.691939,45.076705099999998],[5.6921387,45.077207799999996],[5.6923112,45.077436800000001],[5.6937941,45.0794517],[5.6942843,45.079857199999999],[5.6946114,45.0801947],[5.6956238,45.081291399999998],[5.6965225,45.081045500000002],[5.6970431,45.080850699999999],[5.6974151,45.080584899999998],[5.6983936,45.079742500000002],[5.6988142,45.079530300000002],[5.7010406,45.078735299999998],[5.7019696,45.078226999999998],[5.7019428,45.078078499999997],[5.7018035,45.077855599999999],[5.7030906,45.0774428],[5.7044672,45.077120499999999],[5.7044443,45.076969800000001],[5.7043427,45.076690300000003],[5.7042684,45.076389900000002],[5.704351,45.076094900000001],[5.7046918,45.075832900000002],[5.7056823,45.075481400000001],[5.7068671,45.0750435],[5.7076473,45.074748499999998],[5.7102641,45.073330200000001],[5.7105594,45.073242899999997],[5.7134274,45.072395200000003],[5.7107033,45.070220900000002],[5.7062367,45.065877],[5.7060745,45.0656648],[5.7052135,45.064537000000001],[5.7031692,45.062250200000001],[5.702704,45.061788499999999],[5.7012718,45.060367100000001],[5.7004016,45.058468900000001],[5.6995558,45.0569925],[5.6987473,45.055092399999999],[5.6983103,45.053575000000002],[5.6984501,45.051520400000001],[5.6984348,45.049198699999998],[5.6982675,45.048121700000003],[5.6979621,45.047160699999999],[5.6977624,45.046662900000001],[5.6976965,45.045517699999998],[5.6970155,45.043581099999997],[5.6968784,45.043191200000003],[5.6943852,45.0375838],[5.6944361,45.036640400000003],[5.6944766,45.035744000000001],[5.6943108,45.034461800000003],[5.6938829,45.032739499999998],[5.6938243,45.031034499999997],[5.6940531,45.029526400000002],[5.6947504,45.027930099999999],[5.696006,45.025981999999999],[5.696597,45.024827100000003],[5.6966283,45.024337799999998],[5.6965466,45.023494900000003],[5.6957632,45.022221299999998],[5.6946077,45.020650600000003],[5.6943066,45.019987899999997],[5.6942621,45.019672100000001],[5.6944001,45.019099199999999],[5.6943037,45.018337199999998],[5.6941052,45.017857999999997],[5.6932991,45.0173311],[5.6917676,45.016992999999999],[5.6904539,45.016555400000001],[5.6895171,45.0160415],[5.689032,45.015607899999999],[5.6884864,45.015036100000003],[5.6880211,45.014490000000002],[5.6878023,45.014113899999998],[5.6875112,45.013394900000002],[5.6872837,45.012636700000002],[5.6870887,45.0119896],[5.6871933,45.0115202],[5.6872526,45.010949599999996],[5.6871943,45.0103917],[5.6870639,45.009723999999999],[5.6869606,45.008840999999997],[5.6867955,45.008025099999998],[5.6865535,45.007472499999999],[5.6863403,45.006965800000003],[5.6863245,45.0066256],[5.6864444,45.006366900000003],[5.6843655,45.005539900000002],[5.6839297,45.005505800000002],[5.6835783,45.005338799999997],[5.683238,45.005134099999999],[5.6827447,45.004784600000001],[5.6818666,45.005061699999999],[5.6811177,45.005297800000001],[5.6806905,45.005412700000001],[5.6792757,45.005500099999999],[5.6785808,45.005762599999997],[5.6781089,45.005785600000003],[5.6774186,45.005898700000003],[5.676769,45.006262499999998],[5.6751109,45.007382700000001],[5.6746558,45.007470400000003],[5.6731558,45.0081384],[5.6728649,45.008109500000003],[5.6727138,45.008225699999997],[5.6727759,45.008391799999998],[5.6731973,45.008864600000003],[5.6728887,45.0089854],[5.6728369,45.009919500000002],[5.6726938,45.010175400000001],[5.6687928,45.008627500000003],[5.6680669,45.009039999999999],[5.6673854,45.010458499999999],[5.6675568,45.0109292],[5.6675653,45.0117683],[5.6669957,45.011924499999999],[5.6664077,45.011988000000002],[5.6661535,45.011911400000002],[5.665624,45.012309000000002],[5.6647791,45.0129394],[5.6626175,45.013999300000002],[5.659874,45.015001099999999],[5.6595601,45.015028800000003],[5.6593906,45.015285400000003],[5.6591586,45.015366700000001],[5.6588233,45.015415300000001],[5.6590957,45.016657799999997],[5.6587385,45.016887699999998],[5.6581809,45.017038700000001],[5.6575502,45.017047400000003],[5.6573344,45.016950999999999],[5.6571263,45.016880399999998],[5.6571064,45.016873599999997],[5.6564181,45.017023899999998],[5.6560705,45.0169219],[5.6554904,45.017358199999997],[5.6532839,45.017169500000001],[5.652259,45.016968599999998],[5.6524393,45.017705100000001],[5.6524023,45.018546899999997],[5.6519361,45.019527099999998],[5.6515853,45.020433300000001],[5.6512433,45.021326299999998],[5.6510098,45.022055799999997],[5.6508566,45.022374900000003],[5.6505967,45.022832299999997],[5.6505037,45.023292900000001],[5.6505788,45.023553999999997],[5.6507536,45.023828799999997],[5.6509473,45.024183999999998],[5.6508337,45.024762699999997],[5.6506264,45.025337899999997],[5.6505924,45.026040600000002],[5.6505618,45.026890199999997],[5.6504749,45.027616399999999],[5.6505602,45.027920199999997],[5.6508475,45.0284488],[5.6511911,45.029617000000002],[5.6515981,45.030763999999998],[5.6518848,45.031573199999997],[5.6522721,45.032299999999999],[5.652893,45.032925499999997],[5.6537078,45.033736699999999],[5.6543471,45.034174499999999],[5.6551513,45.035453199999999],[5.6557191,45.0367672],[5.6564498,45.038116000000002],[5.6556625,45.038653500000002],[5.6549815,45.038243999999999],[5.6545926,45.037648900000001],[5.6543394,45.037590899999998],[5.6538824,45.037650599999999],[5.6534543,45.037756100000003],[5.6532673,45.037705500000001],[5.6531133,45.037542000000002],[5.6530219,45.037320800000003],[5.6524361,45.037197599999999],[5.652051,45.036900899999999],[5.6513461,45.036995599999997],[5.6507962,45.037039300000004],[5.6502415,45.036999199999997],[5.6497934,45.036983999999997],[5.6486762,45.037230399999999],[5.6482503,45.037373100000003],[5.6478695,45.037384000000003],[5.6470533,45.037836200000001],[5.646693,45.037743900000002],[5.6438614,45.038608000000004],[5.6437762,45.038032200000004],[5.6434568,45.037966699999998],[5.6428102,45.038162300000003],[5.6421027,45.038210399999997],[5.6417491,45.0382392],[5.6416665,45.037243699999998],[5.6415387,45.036846300000001],[5.6412745,45.0365927],[5.6408321,45.036213600000004],[5.6402726,45.035623299999997],[5.6397294,45.035321699999997],[5.6393317,45.035034600000003],[5.638768,45.034369900000002],[5.6378262,45.033995699999998],[5.6367909,45.033596099999997],[5.6363959,45.0333556],[5.6357566,45.032981999999997],[5.6353359,45.032751500000003],[5.6348411,45.0326071],[5.6344387,45.032469300000002],[5.6341094,45.032226799999997],[5.6339849,45.032118500000003],[5.6338184,45.032197799999999],[5.6304041,45.037647700000001],[5.6305013,45.037971300000002],[5.6304529,45.038280499999999],[5.63037,45.038674499999999],[5.6302449,45.039023100000001],[5.6300879,45.039270000000002],[5.6297916,45.040313599999998],[5.6297775,45.0409948],[5.6296073,45.041708300000003],[5.629705,45.042274399999997],[5.6298258,45.0430171],[5.6301242,45.043642699999999],[5.6297565,45.044119500000001],[5.6292921,45.044514999999997],[5.6290647,45.044913100000002],[5.6289465,45.045149600000002],[5.6289579,45.046725199999997]]]};
				
				// var geojson_layer = L.geoJSON( contour,{
        //             // http://leafletjs.com/reference-1.0.3.html#path-option
        //             style: function(feature) {
        //                 return { interactive: false, fill: false, color: '#ee8a7f' }; 
        //             }
        //         });
				// //map.addLayer(geojson_layer);
					
				// var markersCluster = new L.MarkerClusterGroup();
				
				// var LeafIcon = L.Icon.extend({
				// 	options: {
				// 		iconSize:     [22, 32],
				// 		iconAnchor:   [11, 32],
				// 		popupAnchor:  [1, -34],
				// 		tooltipAnchor: [16, -28]
				// 	}
				// });

				// $("#results article").each( function( i, el ) {
				// 	var latLng = new L.LatLng( $(el).data('lat'), $(el).data('lng'));
				// 	var marker = new L.Marker(
				// 		latLng, { 
				// 			title: $(el).find('.titre').html(),
				// 			icon: new LeafIcon({
				// 				iconUrl: $(el).data('marker')
				// 			})
				// 		});
				// 	marker.bindPopup( $(el).html() );
				// 	markersCluster.addLayer(marker);
				// });
	
				// map.addLayer(markersCluster);
				
				// $(document).on("sf:ajaxstart", ".searchandfilter", function(){
				//   markersCluster.clearLayers();
				// });
				
				// $(document).on("sf:ajaxfinish", ".searchandfilter", function(){
				// 	// recharge les marqueurs
				// 	$("#results article").each( function( i, el ) {
				// 		var latLng = new L.LatLng( $(el).data('lat'), $(el).data('lng'));
				// 		var marker = new L.Marker(latLng, {
				// 			title: $(el).find('titre').html(),
				// 			icon: new LeafIcon({
				// 				iconUrl: $(el).data('marker')
				// 			})
				// 		});
				// 		marker.bindPopup( $(el).html() );
				// 		markersCluster.addLayer(marker);
				// 	});
				// });
			}
	
		});

	});
});